# 基本知识

典型的股票多因子模型将 n 只股票的收益率分解为 m 个因子的线性组合和未被因子解释的残留部分，一般形式为

![多因子模型01](https://github.com/Miya-Su/Quantitative-Trading/raw/miya/image/多因子模型01.png)





其中，r_{i} 为对无风险收益率的超额部分，   x_{ij}为股票i对因子的暴露度，f_{i}为因子收益\\(x_{ij}的名称有许多种，比如因子载荷、因子 beta、斜率、系数、因子敏感度等，此处及后文均采用Barra模型的语境，\\即因子暴露)。x_{ij}是随个股特征不同而变化的部分，而 f_{i}为共同部分（共同因子）。

向量形式：
$$𝒓 = 𝒙_𝟏𝑓_1 +𝒙_𝟐𝑓_2 +⋯+𝒙_𝒎𝑓_𝑚 +𝒖$$



矩阵形式： 

$$𝒓 = 𝑿_𝒇+𝒖$$

其中：

![多因子模型02](https://github.com/Miya-Su/Quantitative-Trading/raw/miya/image/多因子模型02.png)



## 纯因子组合

通过纯因子组合的线性组合可以构造出对每个因子具有指定暴露度的组合。

纯因子组合可将各种风险收益精确的切割开来，求解出纯因子组合中的个股的权重，就可以精确控制组合对因子的暴露度，使组合只对希望暴露的风险因子暴露，从而让风险和收益精确匹配起来。

假设一个投资组合P中的个股权重为：$$w_P$$

则这个投资组合的收益 $$r_p$$: 

$$𝑟_𝑃 = 𝒘_𝑷^ 𝑻𝒓 = 𝒘_𝑷^ 𝑻𝒙_𝟏𝑓_1 +𝒘_𝑷^ 𝑻𝒙_𝟐𝑓_2 +⋯+𝒘_𝑷^ 𝑻𝒙_𝒎𝑓_𝑚 +𝒘_𝑷^ 𝑻𝒖 = 𝑥_𝑃^ 1𝑓_1 +𝑥_𝑃^ 2𝑓_2 +⋯+𝑥_𝑃^ 𝑚𝑓_𝑚 +𝒘_𝑷^ 𝑻𝒖$$


其中  $$𝑥_𝑃^ 𝑚𝑓_𝑚   =w_p^Tx_m=\sum w_ix_im$$ 就是组合P对因子m的因子暴露度。     


一个投资组合的收益可以分解为 m个因子收益的线性组合：

![多因子模型03](https://github.com/Miya-Su/Quantitative-Trading/raw/miya/image/多因子模型03.png) 

如果一个投资组合，对模型中某因子暴露度为 1，对其他风险因子暴露度为 0，则称该组合为这个因子的纯因子组合。

假设因子m对应的纯因子组合$P_M$的权重为  $W_P$$_m$ ，由定义，该组合对各个因子的暴露为 

 $X^1_P$$_m$   =0         $X^2_P$$_m$   =0    ........ $X^m_P$$_m$   =0     ,

因此纯因子组 合的收益为：

![多因子模型04](https://github.com/Miya-Su/Quantitative-Trading/raw/miya/image/多因子模型04.png) 

可见，对于充分分散的组合，因子收益   $f_m$就是因子 对应的纯因子组合   $P_M$的收益。 至此，将  $f_m$ 称作是“收益”才有了很好的解释。通过广义最小二乘法（GLS）就可以 方便的求出   $f_m$的值，同时中间步骤还给出了该纯因子组合中个股的权重$W_P$$_m$ ,即    $f_m$= $W^T_P$$_m$     



 

# 多因子模型构建

多因子模型是个较为复杂的体系，模型的构建流程往往包括以下几个方面：

 ![量化基础知识03](https://github.com/Miya-Su/Quantitative-Trading/raw/miya/image/量化基础知识03.png)



### 样本筛选

全体 A 股 ，为了使测试结果更符合投资逻辑，设定了三条样本筛选规则： 

（1） 剔除选股日的 ST/PT 股票； 

（2） 剔除上市不满一年的股票； 

（3） 剔除选股日由于停牌等原因而无法买入的股票。 



### 数据清洗

避免可能的数据错误和极端数据对测试结果产生影响，使用标准化后的数据保证最终得到的模型的稳健性。数据清洗的内容主要包括两部分，异常值和缺失值的处理。 

常见的因子标准化方法包括：Z 值标准化（Z-Score），Rank 标准化，风格 标准化等等。 由于 Rank 标准化后的数据会丢失原始样本的一些重要信息，这里我们仍然 选择 Z 值标准化来处理因子数据。 





### 因子测试

有效的单因子首先应该具有一定的逻辑支撑，其次则是与股票收益率的相关性较为显著

#### 单因子测试

截面回归（Cross-Section Regression）是目前业界较常用于因子测试的方法，相比全样本面板回归（Panel Data Regression）的方法，截面回归更有利于对因子变化趋势的捕捉。

我们选择每期针对全体样本做一次回归，回归时因子暴露为已知变量，回归 得到每期的一个因子收益值𝑓𝑗，在通过多期回归后我们就可以得到因子值𝑓𝑗 的序列，也就是因子收益率序列，同时可以得到 t 值序列，也就是因子值与 股票收益率相关性的t检验得到的t值。 

针对这两个序列我们将通过以下几个指标来判断 该因子的有效性以及稳定性： 

（1） 因子收益序列𝑓𝑖的假设检验 t 值 

（2） 因子收益序列𝑓𝑖大于 0 的概率 

（3） t 值绝对值的均值 

（4） t 值绝对值大于等于 2 的概率 

IC 值（信息系数）是指个股第 t 期在因子 i 上的因子暴露（剔除行业与市值 后）与 t + 1 期的收益率的相关系数。通过计算 IC 值可以有效的观察到某个因子收益率预测的稳定性和动量特征，以便在优化组合时用作筛选的指标。 常见的计算 IC 值方法有两种：相关系数（Pearson Correlation） 和秩相关系数（ Spearman Rank Correlation）。 

由于 Pearson 相关系数计算时假设变量具有相等间隔以及服从正态分布，而 这一假设往往与因子值和股票收益率的分布情况相左。因此我们将采用 Spearman 的方法计算因子暴露与下期收益率的秩相关性 IC 值。类似回归法 的因子测试流程，我们在计算 IC 时同样考虑剔除了行业因素与市值因素。 

同样我们会得到一个 IC 值序列，类似的，我们将关注以下几个与 IC 值相关 的指标来判断因子的有效性和预测能力： 

（1） IC 值的均值

（2） IC 值的标准差 

（3） IC 大于 0 的比例 

（4） IC 绝对值大于 0.02 的比例 

（5） IR （IR = IC 均值/IC 标准差） 

#### 多因子测试

在完成单个因子的测试之后，就为多因子模型的构建打下了坚实的基础。我们可以通过下面几个步骤来剔除同类因子之间的多重共线性影响，筛选出同时具有良好的单调性和预测性的有效因子，构造我们的多因子模型： 

根据上文的截面回归因子测试方法，我们可以轻松的得到每个因子的因子暴 露值序列和因子 IC 值序列。在研究因子间共线性时，就可以通过计算因子 间 IC 值和因子暴露值得相关性来求证因子间的共线性。

需要注意的是，经济含义相似度较高的同类型因子往往存在明显的正相关性， 在处理此类因子时，我们可以通过一些方法将因子进行合并；而如果是经济 含义差异较大因子之间存在明显相关性，就需要有所取舍。 

消除共线性的方法包括以下几种： 

（1） 在同类因子的共线性较大的几个因子中，保留有效性最高的因子， 剔除余下的因子 

（2） 因子组合：方法包括等权加权，以因子收益 f 为权重加权，以及 PCA 主成分分析法等等 

（3） 暴力迭代法，即将因子两两组合暴力迭代得到表现最好的组合方法。

在对因子集做残差的异方差分析处理之后，就可以进行多元线性回归，估计每期的因子收益序列。 

![量化基础知识04](https://github.com/Miya-Su/Quantitative-Trading/raw/miya/image/量化基础知识04.png)



### 因子的初步筛选 

对每个因子做详尽的分析，具体测试了包括因子收益，因子收益显著性， 因子 IC、IR，分层回溯收益、多空收益，历史 IC 序列相关性等等指标，一般根据前期的测试结果，筛选出了收益率较显著，高 IC、IR 并且单调性得分较高的因子。



### 因子权重的优化—基于因子 IC 

静态因子加权 v.s.动态调整权重 

#### 静态优化IC

复合因子是M 个因子的一个线形组合：因子的 IR 值为因子 IC 的均值与因子 IC 的标准差的比值。因子 IR 值越高， 代表因子综合考虑区分度和稳定性后效果越好,优化目标是使复合因子的信息比 IR 取到最大值。 

#### 动态最优化IR

虑到市场环境变化和风格转变等原因会使得因子的有效性和 IC 值出现波 动，仅仅使用静态的 IC 优化方法给定复合因子中的因子权重会容易导致组 合受风格变化影响而出现较大的波动和回撤构造了一个动态调整的基于 IC 值的复合因子 IR 最优化模型。

动态的最优化权重模型是建立在上面我们提到的静态最优化 IR 模型的基础上的，假设每期优化因子权重时所参考的历史 IC 序列长度为 N 个月。（首先假设组合股票数量为 M=100，手续费单边 0.3%，每月初调仓，则在不 同的参数 N 下）

一般动态的最优化 IR 赋权方法要优于静态的因子赋权法



### 因子赋权组合

组合内等权 v.s.复合因子得分加权 
在构建每月调仓组合时，入选标的的赋权方式包括等权和按复合因子的得分加权两种方法。

（EW 为等权，SW 为复合因子得分加权）
